version: '2.2'
services: 
    PSQL:
        image: postgres
        container_name: teamcity-postgres
        restart: always
        environment: 
            POSTGRES_PASSWORD: password #set your password 
            PGDATA: /var/lib/postgresql/data/pgdata
        volumes: 
            - /opt/teamcity/postgresql/data:/var/lib/postgresql/data
    TeamCity:
        image: teamcity-server
        container_name: teamcity-server
        restart: always
        ports: 
            - "8111:8111"
        volumes: 
            - /opt/teamcity/data:/data/teamcity_server/datadir
            - /opt/teamcity/logs:/opt/teamcity/logs
        cpus: '2'
    TeamCityAgent:
        image: teamcity-agent
        container_name: teamcity-agent
        restart: always
        environment:
          SERVER_URL: "172.17.0.1" #set your docker ip
        volumes: 
            - /var/run/docker.sock:/var/run/docker.sock
            - /var/teamcity/agent/conf:/data/teamcity_agent/conf
